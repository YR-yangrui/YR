#图论
* **图:** G=(V,E)
* **有向边:** e(u,v)

网络流
--
[摘自hihocoder116周](Jhttps://hihocoder.com/problemset/problem/1378)
* **容量** c(u,v)

* **割(S,T)**

      割的定义为一种点的划分方式：将所有的点划分S和T=V-S两个部分，其中源点s∈S，汇点t∈T。

#####净流f(S,T)表示穿过割(S,T)的流量之和，即：f(S,T) = Σf(u,v) | u∈S,v∈T
举个例子（该例子选自算法导论）:

![例子](http://media.hihocoder.com/problem_images/20160917/14741006888435.jpg)

    净流f = f(2,4)+f(3,4)+f(3,5) = 12+(-4)+11 = 19
* **割的容量**C(S,T)为所有从S到T的边容量之和，即:

      C(S,T) = Σc(u,v) | u∈S,v∈T
同样在上面的例子中，其割的容量为:
      C(S,T) = Σc(u,v) | u∈S,v∈T

小Ho：也就是说在计算割(S,T)的净流f(S,T)时可能存在反向的流使得f(u,v)<0，而容量C(S,T)一定是非负数。

小Hi：你这么说也没错。实际上对于任意一个割的净流f(S,T)总是和网络流的流量f相等。比如上面例子中我们改变一下割的方式：

![例子2](http://media.hihocoder.com/problem_images/20160917/14741006882954.jpg =130x140)

可以计算出对于这两种情况净流f(S,T)仍然等于19。

一个直观的解释是：根据网络流的定义，只有源点s会产生流量，汇点t会接收流量。因此任意非s和t的点u，其净流量一定为0，也即是Σ(f(u,v))=0。而源点s的流量最终都会通过割(S,T)的边到达汇点t，所以网络流的流f等于割的静流f(S,T)。

严格的证明如下：
```
f(S,T) = f(S,V) - f(S,S)
从S到T的流等于从S到所有节点的流减去从S到S内部节点的流
f(S,T) = f(S,V)
由于S内部的节点之间存在的流一定有对应的反向流，因此f(S,S)=0
f(S,T) = f(s,V) + f(S-s,V)
再将S集合分成源点s和其他属于S的节点
f(S,T) = f(s,V)
```
由于除了源点s以外其他节点不会产生流，因此f(S-s,V)=0
f(S,T) = f(s,V) = f

所以f(S,T)等于从源点s出来的流，也就是网络的流f。

小Ho：简单理解的话，也就是说**任意一个割的净流f(S,T)都等于当前网络的流量f**。

小Hi：是这样的。而对于任意一个割的净流f(S,T)一定是小于等于割的容量C(S,T)。那也即是，对于网络的任意一个流f一定是小于等于任意一个割的容量C(S,T)。

而在所有可能的割中，存在一个容量最小的割，我们称其为**最小割**。

这个最小割限制了一个网络的流f上界，所以有：

**对于任一个网络流图来说，其最大流一定是小于等于最小割的。**

小Ho：但是这和增广路又有什么关系呢？

小Hi：接下来就是重点了。利用上面讲的知识，我们可以推出一个最大流最小割定理：

```
对于一个网络流图G=(V,E)，其中有源点s和汇点t，那么下面三个条件是等价的：
1. 流f是图G的最大流
2. 残留网络Gf不存在增广路
3. 对于G的某一个割(S,T)，此时f = C(S,T)
```
首先证明**1 => 2**：

我们利用反证法，假设流f是图G的最大流，但是残留网络中还存在有增广路p，其流量为fp。则我们有流f'=f+fp>f。这与f是最大流产生矛盾。

接着证明**2 => 3**：

假设残留网络Gf不存在增广路，所以在残留网络Gf中不存在路径从s到达t。我们定义S集合为：当前残留网络中s能够到达的点。同时定义T=V-S。
此时(S,T)构成一个割(S,T)。且对于任意的u∈S,v∈T，有f(u,v)=c(u,v)。若f(u,v)<c(u,v)，则有Gf(u,v)>0，s可以到达v，与v属于T矛盾。
因此有f(S,T)=Σf(u,v)=Σc(u,v)=C(S,T)。

最后证明**3 => 1**：

    由于f的上界为最小割，当f到达割的容量时，显然就已经到达最大值，因此f为最大流。 

这样就说明了为什么找不到增广路时，所求得的一定是最大流。

小Ho：原来是这样，我明白了。

---

最大闭合子图

![摘自hihocoder119周](https://hihocoder.com/problemset/problem/1398)

* **闭合子图**

所谓闭合子图就是给定一个有向图，从中选择一些点组成一个点集V。对于V中任意一个点，其后续节点都仍然在V中。比如：

![](http://media.hihocoder.com/problem_images/20161008/14759139776998.jpg)

在这个图中有8个闭合子图：∅,{3},{4},{2,4},{3,4},{1,3,4},{2,3,4},{1,2,3,4}

* **求法:**
   使用网络流
```
对于一般的图来说：首先建立源点s和汇点t，将源点s与所有权值为正的点相连，容量为权值；将所有权值为负的点与汇点t相连，
容量为权值的绝对值；权值为0的点不做处理；同时将原来的边容量设置为无穷大。举个例子：
```
![](http://media.hihocoder.com/problem_images/20161008/14759139785938.jpg)

* **结论: 最大权闭合子图的权值等于所有正权点之和减去最小割**
   **证明**

  >1.最小割一定是简单割

###简单割指得是：割(S,T)中每一条割边都与s或者t关联，这样的割叫做简单割。
因为在图中将所有与s相连的点放入割集就可以得到一个割，且这个割不为正无穷。而最小割一定小于等于这个割，所以最小割一定不包含无穷大的边。因此最小割一定一个简单割。

   >2.简单割一定和一个闭合子图对应

**闭合子图V和源点s构成S集，其余点和汇点t构成T集**。
首先证明闭合子图是简单割：若闭合子图对应的割(S,T)不是简单割，则**割(S,T)中**存在一条边(u,v)，u∈S，v∈T，且c(u,v)=∞。说明u的后续节点v不在S中，产生矛盾。(闭合子图与源点s相连，所以怎么地都只要割与源点s相连的边就行了，肯定是简单割）

接着证明简单割是闭合子图：对于V中任意一个点u，u∈S。u的任意一条出边c(u,v)=∞，不会在简单割的割边集中，因此v不属于T，v∈S。所以V的所有点均在S中，因此S-s是闭合子图。

由上面两个引理可以知道，最小割也对应了一个闭合子图，接下来证明最小割就是最大权的闭合子图。

首先有**割的容量C(S,T)=T中所有正权点的权值之和+S中所有负权点的权值绝对值之和**。

**闭合子图的权值W=S中所有正权点的权值之和-S中所有负权点的权值绝对值之和**。

则有**C(S,T)+W=T中所有正权点的权值之和+S中所有正权点的权值之和=所有正权点的权值之和**。

所以**W=所有正权点的权值之和-C(S,T)**

由于所有正权点的权值之和是一个定值，那么割的容量越小，W也就越大。因此当C(S,T)取最小割时，W也就达到了最大权。
